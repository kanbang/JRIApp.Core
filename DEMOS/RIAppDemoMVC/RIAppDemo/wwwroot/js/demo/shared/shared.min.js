var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};define("common",["require","exports","jriapp","jriapp_db","jriapp_ui"],function(n,t,i,r,u){"use strict";function h(n,t,i){var r;return!i||(f.str.startsWith(i,"%")&&f.str.endsWith(i,"%")?(r=f.str.trim(i,["%"," "]),n.where(t,4,[r])):f.str.startsWith(i,"%")?(r=f.str.trim(i,["%"," "]),n.where(t,3,[r])):f.str.endsWith(i,"%")?(r=f.str.trim(i,["%"," "]),n.where(t,2,[r])):(r=f.str.trim(i),n.where(t,0,[r]))),n}function c(){var n=i.DOM.queryOne(document,"input[name=__RequestVerificationToken]");return n?n.value:""}function l(n){n.registerElView("fileLink",e);n.registerElView("fileImage",o)}var f,e,o,s;Object.defineProperty(t,"__esModule",{value:!0});t.initModule=t.ErrorViewModel=t.FileImgElView=t.DownloadLinkElView=t.getAntiForgeryToken=t.addTextQuery=void 0;f=i.Utils;t.addTextQuery=h;t.getAntiForgeryToken=c;e=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._baseUri="",!i.baseUri||(r._baseUri=i.baseUri),r._id="",t.innerHTML='<i class="fas fa-download"><\/i><span class="ml-1"><\/span>',r._span=t.children[1],r}return __extends(t,n),Object.defineProperty(t.prototype,"text",{get:function(){return this._span.textContent},set:function(n){var t=this._span,i=this.text;n=n?""+n:"";i!==n&&(t.textContent=n,this.objEvents.raiseProp("text"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"href",{get:function(){return this.el.href},set:function(n){var t=this.href;n=n?""+n:"";t!==n&&(this.el.href=n,this.objEvents.raiseProp("href"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(n){var t=this._id;n=n?""+n:"";t!==n&&(this._id=n,this.href=this._baseUri+"/"+this._id,this.objEvents.raiseProp("id"))},enumerable:!1,configurable:!0}),t}(u.BaseElView);t.DownloadLinkElView=e;o=function(n){function t(t,r){var u=n.call(this,t,r)||this;return u._debounce=new i.Debounce,u._baseUri="",!r.baseUri||(u._baseUri=r.baseUri),u._id="",u._src=null,u._fileName=null,u}return __extends(t,n),t.prototype.dispose=function(){this.getIsDisposed()||(this.setDisposing(),this._debounce.dispose(),n.prototype.dispose.call(this))},t.prototype.reloadImg=function(){var n,t,i;!this.src||(n=this.src,t=n.indexOf("?"),t>=0&&(n=n.substr(0,t)),i=new Date,this.src=n+"?v="+i.getTime())},Object.defineProperty(t.prototype,"fileName",{get:function(){return this._fileName},set:function(n){var t=this._fileName;t!==n&&(this._fileName=n,this.objEvents.raiseProp("fileName"),this.reloadImg())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(n){var i=this,t;this._src!==n&&(this._src=n,this.objEvents.raiseProp("src"));t=this.el;t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";this._debounce.enque(function(){!i._src||(t.src=i._src)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(n){var t=this._id;n=n===null?"":""+n;t!==n&&(this._id=n,this.src=this._id?this._baseUri+"/"+this._id:null,this.objEvents.raiseProp("id"))},enumerable:!1,configurable:!0}),t}(u.BaseElView);t.FileImgElView=o;s=function(n){function t(t){var e=n.call(this,t)||this,f=e,o;return e._error=null,e._errors=[],e._message=null,e._title="",e._dialogVM=new u.DialogVM(t),o={templateID:"errorTemplate",width:500,height:300,title:"",canCancel:!1,fn_OnShow:function(n){while(!!f.error&&!!f.error.origError)f._error=f.error.origError,f.objEvents.raiseProp("error");f.title=f.error instanceof r.AccessDeniedError?"ACCESS DENIED":f.error instanceof r.ConcurrencyError?"CONCURRENCY ERROR":f.error instanceof i.ValidationError?"VALIDATION ERROR":f.error instanceof r.SvcValidationError?"VALIDATION ERROR":f.error instanceof r.DataOperationError?"DATA OPERATION ERROR":"UNEXPECTED ERROR";n.title=f.title},fn_OnClose:function(){f._error=null;f._errors=[];f._message=null;f.objEvents.raiseProp("error");f.objEvents.raiseProp("message")}},e._dialogVM.createDialog("errorDialog",o),e}return __extends(t,n),t.prototype.showDialog=function(){this._dialogVM.showDialog("errorDialog",this)},t.prototype.dispose=function(){this.getIsDisposed()||(this.setDisposing(),this._dialogVM.dispose(),this._dialogVM=null,this._error=null,this._errors=[],this._message=null,n.prototype.dispose.call(this))},Object.defineProperty(t.prototype,"error",{get:function(){return this._error},set:function(n){var t=this,r=this._error,i;r?(this._errors.push(n),this.objEvents.raiseProp("errorCount")):(this._error=n,i="",i=t.error?t.error.message?t.error.message:""+t.error:"Error!",this.message=i,this.objEvents.raiseProp("error"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},set:function(n){var t=this._title;t!==n&&(this._title=n,this.objEvents.raiseProp("title"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},set:function(n){var t=this._message;t!==n&&(this._message=n,this.objEvents.raiseProp("message"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorCount",{get:function(){return this._errors.length+1},enumerable:!1,configurable:!0}),t}(i.ViewModel);t.ErrorViewModel=s;t.initModule=l});define("autocomplete",["require","exports","jriapp","jriapp_ui","common"],function(n,t,i,r,u){"use strict";function l(n,t){var i=n.findElViewsByDataName(t);return!!i&&i.length>0?i[0]:null}function c(n,t){var i=n.findElByDataName(t);return!!i&&i.length>0?i[0]:null}function a(n){n.registerElView("autocomplete",o)}var o;Object.defineProperty(t,"__esModule",{value:!0});t.initModule=t.AutoCompleteElView=void 0;var s=i.bootstrapper,h=i.Utils,f=r.$,e=i.DOM;o=function(n){function t(t,i){var r=n.call(this,t,i)||this,u=r,o,s;r._templateId=i.templateId;r._fieldName=i.fieldName;r._dbSetName=i.dbSetName;r._queryName=i.queryName;r._dbContext=i.dbContext;r._minTextLength=!i.minTextLength?1:i.minTextLength;r._template=null;r._gridDataSource=null;r._prevText=null;r._template=null;r._$dropDown=null;r._loadTimeout=null;r._dataContext=null;r._isLoading=!1;r._grid=null;r._btnOk=null;r._btnCancel=null;r._width=i.width||"200px";r._height=i.height||"330px";o=f(r.el);o.on("change."+r.uniqueID,function(n){n.stopPropagation();u._onTextChange();u.objEvents.raiseProp("value")});o.on("keyup."+r.uniqueID,function(n){n.stopPropagation();u._onKeyUp(n.target.value,n.keyCode);u._onKeyPress(n.keyCode)});o.on("keypress."+r.uniqueID,function(n){n.stopPropagation()});return r._isOpen=!1,r._createGridDataSource(),s=e.document.createElement("div"),r._template=r._createTemplate(s),r._$dropDown=f(s),r._$dropDown.css({position:"absolute","z-index":"10000",left:"-2000px",top:"-1000px","background-color":"white",border:"1px solid gray",width:r._width,height:r._height}),e.document.body.appendChild(s),r}return __extends(t,n),t.prototype.templateLoading=function(){},t.prototype.templateLoaded=function(n,t){if(!this.getIsStateDirty()&&!t){var i=this,r=l(n,"lookupGrid");!r||(this._grid=r.grid);this._btnOk=c(n,"btnOk");this._btnCancel=c(n,"btnCancel");f(this._btnOk).click(function(){i._updateSelection();i._hide()});f(this._btnCancel).click(function(){i._hide()})}},t.prototype.templateUnLoading=function(){},t.prototype._createGridDataSource=function(){if(this._gridDataSource=this._getDbContext().getDbSet(this._dbSetName),!this._gridDataSource)throw new Error(h.str.format("dbContext does not contain dbSet with the name: {0}",this._dbSetName));},t.prototype._getDbContext=function(){return this._dbContext},t.prototype._createTemplate=function(n){var t=i.createTemplate({parentEl:n,dataContext:this,templEvents:this});return t.templateID=this._templateId,t},t.prototype._onTextChange=function(){},t.prototype._onKeyUp=function(n,t){var i=this;clearTimeout(this._loadTimeout);!!n&&n.length>=i._minTextLength?this._loadTimeout=setTimeout(function(){i.getIsStateDirty()||i._prevText!=n&&(i._prevText=n,t===27||t==13||(i._isOpen||i._open(),i.load(n)))},500):i.gridDataSource.clear()},t.prototype._onKeyPress=function(n){return(n===13&&this._updateSelection(),n===27||n===9||n===13)?(this._hideAsync(),!0):!1},t.prototype._hideAsync=function(){var n=this;return h.async.delay(function(){n._hide()},100)},t.prototype._updateSelection=function(){this.value=this.currentSelection},t.prototype._updatePosition=function(){this._$dropDown.position({my:"left top",at:"left bottom",of:f(this.el),offset:"0 0"})},t.prototype._onShow=function(){this.objEvents.raise("show",{})},t.prototype._onHide=function(){this.objEvents.raise("hide",{});this.objEvents.raiseProp("value")},t.prototype._open=function(){var n,t,i;if(!this._isOpen){if(n=this,!!this._grid){t=this._$dropDown.get(0);i=n.el;f(e.document).on("mousedown."+this.uniqueID,function(r){e.isContained(r.target,t)||e.isContained(r.target,i)||n._hideAsync()});this._grid.addOnCellDblClicked(function(){n._updateSelection();n._hide()},this.uniqueID);s.selectedControl=n._grid;f(e.document).on("keyup."+this.uniqueID,function(t){s.selectedControl===n._grid&&n._onKeyPress(t.which)&&t.stopPropagation()});this._grid.dataSource=this.gridDataSource}this._updatePosition();this._isOpen=!0;this._onShow()}},t.prototype._hide=function(){this._isOpen&&(f(e.document).off("."+this.uniqueID),!this._grid||this._grid.objEvents.offNS(this.uniqueID),this._$dropDown.css({left:"-2000px"}),!this._grid||(this._grid.dataSource=null),this._isOpen=!1,this._onHide())},t.prototype.getDataContext=function(){return this._dataContext},t.prototype.setDataContext=function(n){var t=this._dataContext;this._dataContext!==n&&(!t||t.objEvents.offNS(this.uniqueID),this._dataContext=n,this.objEvents.raiseProp("dataContext"),this._dataContext||this._hideAsync())},t.prototype.load=function(n){var i=this,t=this.gridDataSource.createQuery(this._queryName);t.pageSize=50;t.isClearPrevData=!0;u.addTextQuery(t,this._fieldName,n+"%");t.orderBy(this._fieldName);this._isLoading=!0;this.objEvents.raiseProp("isLoading");t.load().finally(function(){i._isLoading=!1;i.objEvents.raiseProp("isLoading")})},t.prototype.dispose=function(){this.getIsDisposed()||(this.setDisposing(),this._hide(),f(this.el).off("."+this.uniqueID),!this._grid||(this._grid=null),!this._template||(this._template.dispose(),this._template=null,this._$dropDown=null),this._gridDataSource=null,this._dataContext=null,n.prototype.dispose.call(this))},Object.defineProperty(t.prototype,"fieldName",{get:function(){return this._fieldName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateId",{get:function(){return this._templateId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSelection",{get:function(){return this._gridDataSource.currentItem?this._gridDataSource.currentItem[this._fieldName]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this._template},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataContext",{get:function(){return this.getDataContext()},set:function(n){this.setDataContext(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridDataSource",{get:function(){return this._gridDataSource},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.el.value},set:function(n){var t=this.value,i=""+n;n=n?i:"";t!==n&&(this.el.value=n,this._prevText=n,this.objEvents.raiseProp("value"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),t}(r.InputElView);t.AutoCompleteElView=o;t.initModule=a});define("expander",["require","exports","jriapp_ui"],function(n,t,i){"use strict";function o(n){n.registerElView("expander",r)}var u;Object.defineProperty(t,"__esModule",{value:!0});t.initModule=t.ExpanderElView=t.PROP_NAME=void 0,function(n){n.isExpanded="isExpanded"}(u=t.PROP_NAME||(t.PROP_NAME={}));var f="fas fa-angle-double-up",e="fas fa-angle-double-down",r=function(n){function t(t,i){var r=this,u=i.expandedsrc||f,o=i.collapsedsrc||e,s=!!i.isExpanded;return i.imageSrc=null,r=n.call(this,t,i)||this,r._expandedsrc=u,r._collapsedsrc=o,r.isExpanded=s,r}return __extends(t,n),t.prototype.refresh=function(){this.getIsStateDirty()||(this.glyph=this._isExpanded?this._expandedsrc:this._collapsedsrc)},t.prototype._onCommandChanged=function(){n.prototype._onCommandChanged.call(this);this.invokeCommand()},t.prototype.onClick=function(){this.isExpanded=!this.isExpanded},t.prototype._getCommandParam=function(){return{isExpanded:this.isExpanded}},t.prototype.invokeCommand=function(){this.refresh();n.prototype.invokeCommand.call(this)},t.prototype.toString=function(){return"ExpanderElView"},Object.defineProperty(t.prototype,"isExpanded",{get:function(){return this._isExpanded},set:function(n){this._isExpanded!==n&&(this._isExpanded=n,this.invokeCommand(),this.objEvents.raiseProp("isExpanded"))},enumerable:!1,configurable:!0}),t}(i.AnchorElView);t.ExpanderElView=r;t.initModule=o});define("header",["require","exports","jriapp","jriapp_ui"],function(n,t,i,r){"use strict";var u,f;Object.defineProperty(t,"__esModule",{value:!0});t.HeaderVM=t.contentPanel=t.topPanel=void 0;u=r.$;t.topPanel="#demoHeader";t.contentPanel="#demoContent";f=function(n){function r(r){var f=n.call(this,r)||this;return f._$topPanel=u(t.topPanel),f._$contentPanel=u(t.contentPanel),f._contentPanelHeight=0,!f._$contentPanel||(f._contentPanelHeight=f._$contentPanel.height()),f._expanderCommand=new i.Command(function(n){n.isExpanded?f.expand():f.collapse()}),f}return __extends(r,n),r.prototype.addOnUpdateUI=function(n,t){this.objEvents.on("updateUI",n,t)},r.prototype.expand=function(){var n=this;this._$topPanel.slideDown("fast",function(){return n.updateUI(!1)})},r.prototype.collapse=function(){var n=this;this._$topPanel.slideUp("fast",function(){return n.updateUI(!0)})},r.prototype.updateUI=function(n){var t={isHandled:!1,isUp:n};(this.objEvents.raise("updateUI",t),t.isHandled)||!this._$contentPanel||(n?this._$contentPanel.height(this._contentPanelHeight):this._$contentPanel.height(this._contentPanelHeight-this._$topPanel.outerHeight()))},Object.defineProperty(r.prototype,"expanderCommand",{get:function(){return this._expanderCommand},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"$contentPanel",{get:function(){return this._$contentPanel},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"$topPanel",{get:function(){return this._$topPanel},enumerable:!1,configurable:!0}),r}(i.ViewModel);t.HeaderVM=f});define("mixobj",["require","exports","jriapp_shared/utils/checks","jriapp_shared/utils/error","jriapp_shared/utils/weakmap","jriapp_shared/object"],function(n,t,i,r,u,f){"use strict";function h(n){return function(n){function t(){for(var i,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return i=n.apply(this,r)||this,e.set(i,{objState:0,events:null}),i}return __extends(t,n),t.prototype.isHasProp=function(n){return o.isHasProp(this,n)},t.prototype.handleError=function(n,t){var u,i;return r.ERROR.checkIsDummy(n)?!0:(n.message||(n=new Error("Error: "+n)),u={error:n,source:t,isHandled:!1},this.objEvents.raise("error",u),i=u.isHandled,i||(i=r.ERROR.handleError(this,n,t)),i)},t.prototype.getIsDisposed=function(){var n=e.get(this);return!n||n.objState===2},t.prototype.getIsStateDirty=function(){var n=e.get(this);return!n||n.objState!==0},t.prototype.dispose=function(){var n=e.get(this);if(n&&n.objState!==2)try{!n.events||(n.events.raise("disposed",{}),n.events.off(),n.events=null)}finally{n.objState=2;e.delete(this)}},Object.defineProperty(t.prototype,"objEvents",{get:function(){var n=e.get(this);return!n||n.objState===2?f.dummyEvents:(n.events||(n.events=f.createObjectEvents(this)),n.events)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"__objSig",{get:function(){return s},enumerable:!1,configurable:!0}),t}(n)}Object.defineProperty(t,"__esModule",{value:!0});t.MixObject=void 0;var o=i.Checks,s=f.objSignature,e=u.createWeakMap();t.MixObject=h});define("monthpicker",["require","exports","jriapp_ui"],function(n,t,i){"use strict";function f(n){n.registerElView("monthpicker",u)}Object.defineProperty(t,"__esModule",{value:!0});t.initModule=t.MonthPickerElView=void 0;var r=i.$,u=function(n){function t(t,i){var u=n.call(this,t,i)||this,f=u,e=r(u.el);return e.MonthPicker({OnAfterChooseMonth:function(){f.objEvents.raiseProp("value")},Button:"<button type='button' class='btn-sm btn-outline-secondary input-group-btn'><i class='fas fa-ellipsis-h'><\/i><\/button>"}),u}return __extends(t,n),t.prototype.dispose=function(){if(!this.getIsDisposed()){this.setDisposing();var t=r(this.el);i.JQueryUtils.dispose$Plugin(t,"MonthPicker");n.prototype.dispose.call(this)}},t.prototype.toString=function(){return"MonthPickerElView"},t}(i.TextBoxElView);t.MonthPickerElView=u;t.initModule=f});define("ssevents",["require","exports","jriapp"],function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SSEventsVM=void 0;var u=i.bootstrapper,r=i.Utils,f=function(n){function t(t,r){var f=n.call(this)||this,e=f;return f._es=null,f._deffered=null,f._baseUrl=t,f._clientID=r,f._url=f._baseUrl+"?id="+r,f._closeClientUrl=f._baseUrl+"/CloseClient?id="+r,f._postMsgUrl=f._baseUrl+"/PostMessage",f._openESCommand=new i.Command(function(){e.open().catch(function(n){e.handleError(n,e)})},function(){return!f._es}),f._closeESCommand=new i.Command(function(){e.close()},function(){return!!f._es}),u.addOnUnLoad(function(){return e.close()}),f}return __extends(t,n),t.isSupported=function(){try{return!!EventSource}catch(n){return!1}},t.prototype.getEventNames=function(){return["open","close","error","message"]},t.prototype._onEsOpen=function(){clearTimeout(this._timeOut);this._timeOut=null;!this._deffered||(this._deffered.resolve(),this._deffered=null)},t.prototype._onEsError=function(){this.handleError("EventSource error",this);this.close()},t.prototype._onMsg=function(n){var t=JSON.parse(n.data);this.objEvents.raise("message",{message:n.data,data:t})},t.prototype._close=function(){if(!this._timeOut||clearTimeout(this._timeOut),this._timeOut=null,!this._deffered||this._deffered.reject({message:"EventSource closed"}),this._deffered=null,!!this._es)try{this._es.close();this._es=null;this._openESCommand.raiseCanExecuteChanged();this._closeESCommand.raiseCanExecuteChanged()}catch(n){this._es=null}},t.prototype.addOnMessage=function(n,t){this.objEvents.on("message",n,t)},t.prototype.open=function(){var n=this;return!this._deffered?(this._deffered=r.async.createDeferred(),this._timeOut=setTimeout(function(){n._timeOut=null;!n._deffered||(n._deffered.reject({message:"EventSource connect timeout!"}),n._deffered=null,n._close())},1e4),this._es||(this._es=new EventSource(n.url),this._es.addEventListener("message",function(t){n._onMsg(t)},!1),this._es.addEventListener("open",function(t){n._onEsOpen(t)},!1),this._es.addEventListener("error",function(t){n._onEsError(t)},!1),this._openESCommand.raiseCanExecuteChanged(),this._closeESCommand.raiseCanExecuteChanged()),this._deffered.promise()):this._deffered.promise()},t.prototype.close=function(){if(this._es)try{this._close()}finally{r.http.postAjax(this._closeClientUrl,null)}},t.prototype.post=function(n,t){var i={message:n},u=JSON.stringify({payload:i,clientID:t?t:this._clientID});return r.http.postAjax(this._postMsgUrl,u)},t.prototype.dispose=function(){if(!this.getIsDisposed()){this.setDisposing();try{this.close()}finally{n.prototype.dispose.call(this)}}},Object.defineProperty(t.prototype,"es",{get:function(){return this._es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"openESCommand",{get:function(){return this._openESCommand},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"closeESCommand",{get:function(){return this._closeESCommand},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this._baseUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientID",{get:function(){return this._clientID},enumerable:!1,configurable:!0}),t}(i.BaseObject);t.SSEventsVM=f});define("uploader",["require","exports","jriapp_shared"],function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Uploader=void 0;var u=i.Utils,r=u.async,f=function(n){function t(t,i){var r=n.call(this)||this;return r._uploadUrl=t,r._file=i,r}return __extends(t,n),t.prototype.addOnProgress=function(n,t){this.objEvents.on("progress",n,t)},t.prototype.addOnAddHeaders=function(n,t){this.objEvents.on("addheaders",n,t)},t.prototype.uploadFile=function(){var i=this,n=this._file,t=new FormData;return t.append("file",n),i._uploadFile(n,t).then(function(){return n.name})},t.prototype._uploadFile=function(n,t){var e=this,i=new XMLHttpRequest,o=i.upload,u,s,f,h;return i.responseType="text",u=r.createDeferred(),o.onload=function(){r.delay(function(){return u.resolve()},100)},o.onprogress=function(n){e.objEvents.raise("progress",n.loaded/n.total)},o.onerror=function(){u.reject(new Error("Uploading file "+n.name+" error"))},i.open("post",e.uploadUrl,!0),s=encodeURIComponent(n.name),i.setRequestHeader("X-File-Name",s),i.setRequestHeader("X-File-Size",n.size.toString()),i.setRequestHeader("X-File-Type",n.type),f={xhr:i,promise:null},e.objEvents.raise("addheaders",f),h=f.promise?f.promise:r.resolve(),h.then(function(){return i.send(t),u.promise()})},Object.defineProperty(t.prototype,"uploadUrl",{get:function(){return this._uploadUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fileName",{get:function(){return this._file.name},enumerable:!1,configurable:!0}),t}(i.BaseObject);t.Uploader=f});define("websocket",["require","exports","jriapp"],function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WebSocketsVM=void 0;var r=i.bootstrapper,u=i.Utils,f=function(n){function t(t){var u=n.call(this)||this,f=u;return u._ws=null,u._clientID=null,u._deffered=null,u._url=t,u._openWsCommand=new i.Command(function(){u.open().catch(function(n){f.handleError(n,f)})},function(){return!f._ws}),u._closeWsCommand=new i.Command(function(){u.close()},function(){return!!u._ws}),r.addOnUnLoad(function(){return f.close()}),u}return __extends(t,n),t.createUrl=function(n,t,i){t=!t?"PollingService":t;return(i?"wss://":"ws://")+window.location.host.split(":")[0]+":"+n+"/"+t},t.isSupported=function(){try{return!!WebSocket}catch(n){return!1}},t.prototype.getEventNames=function(){return["open","close","error","message"]},t.prototype._onWsOpen=function(){},t.prototype._onWsClose=function(){this._ws=null;this._clientID=null;clearTimeout(this._timeOut);this._timeOut=null;this._ws=null;this._clientID=null;this._openWsCommand.raiseCanExecuteChanged();this._closeWsCommand.raiseCanExecuteChanged();!this._deffered||(this._deffered.reject("Websocket closed"),this._deffered=null);this.objEvents.raise("close",{})},t.prototype._onWsError=function(){this.handleError("Websocket error",this);this.close()},t.prototype._onMsg=function(n){var t=JSON.parse(n.data);t.Tag=="connect"?(clearTimeout(this._timeOut),this._timeOut=null,this._clientID=t.Payload.id,!this._deffered||(this._deffered.resolve(this._clientID),this._deffered=null)):t.Tag=="closed"?this.close():t.Tag=="message"?this.objEvents.raise("message",{message:n.data,data:t.Payload}):console.log(n.data)},t.prototype.addOnMessage=function(n,t,i){this.objEvents.on("message",n,t,i)},t.prototype.open=function(){var n=this,t;return!this._deffered?(this._deffered=u.async.createDeferred(),!!this._ws&&!!this._clientID)?(this._deffered.resolve(this._clientID),t=this._deffered.promise(),this._deffered=null,t):(this._timeOut=setTimeout(function(){n._timeOut=null;!n._deffered||(n._deffered.reject("Websocket connection timeout: "+n._url),n._deffered=null,n.close())},5e3),this._ws||(this._ws=new WebSocket(n.url),this._ws.onopen=function(t){n._onWsOpen(t)},this._ws.onclose=function(t){n._onWsClose(t)},this._ws.onmessage=function(t){n._onMsg(t)},this._ws.onerror=function(t){n._onWsError(t)},this._openWsCommand.raiseCanExecuteChanged(),this._closeWsCommand.raiseCanExecuteChanged()),this._deffered.promise()):this._deffered.promise()},t.prototype.close=function(){if(clearTimeout(this._timeOut),this._timeOut=null,!this._deffered||this._deffered.reject("Websocket closed"),this._deffered=null,!!this._ws)try{this._ws.close();this._ws=null;this._clientID=null;this._openWsCommand.raiseCanExecuteChanged();this._closeWsCommand.raiseCanExecuteChanged()}catch(n){this._ws=null;this._clientID=null}},t.prototype.dispose=function(){if(!this.getIsDisposed()){this.setDisposing();try{this.close()}finally{n.prototype.dispose.call(this)}}},Object.defineProperty(t.prototype,"ws",{get:function(){return this._ws},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"openWsCommand",{get:function(){return this._openWsCommand},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"closeWsCommand",{get:function(){return this._closeWsCommand},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(n){this._url=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientID",{get:function(){return this._clientID},enumerable:!1,configurable:!0}),t}(i.BaseObject);t.WebSocketsVM=f});define("dropdownbox",["require","exports","jriapp","jriapp_ui"],function(n,t,i,r){"use strict";function a(n,t){var i=n.findElViewsByDataName(t);return!!i&&i.length>0?i[0]:null}function h(n,t){var i=n.findElByDataName(t);return!!i&&i.length>0?i[0]:null}function v(n){n.registerElView("dropdownbox",o)}var c,l,o;Object.defineProperty(t,"__esModule",{value:!0});t.initModule=t.DropDownBoxElView=void 0;var s=i.bootstrapper,e=i.Utils,f=r.$,u=i.DOM;(function(n){n.Selected="Выбрано";n.NoSelection="Ничего не выбрано"})(c||(c={}));l={BUTTON:"btn-dropdown"};o=function(n){function t(t,r){var o=n.call(this,t,r)||this,v=o,h,a,s,c;if(o._templateId=r.templateId,!!r.dataSource&&!e.sys.isCollection(r.dataSource))throw new Error("Invalid dataSource");o._template=null;o._valuePath=r.valuePath;o._textPath=r.textPath;o._dataSource=r.dataSource;o._selected={};o._selectedCount=0;o._selectedClone={};o._$dropDown=null;o._grid=null;o._btnOk=null;o._btnCancel=null;o._width=r.width||"250px";o._height=r.height||"330px";h=f(o.el);h.on("click."+o.uniqueID,function(n){n.stopPropagation();v._onClick()});h.on("keyup."+o.uniqueID,function(n){n.stopPropagation();v._onKeyPress(n.keyCode)});h.on("keypress."+o.uniqueID,function(n){n.stopPropagation()});o._isOpen=!1;a=u.document.createElement("div");o._template=o._createTemplate(a);o._$dropDown=f(a);o._$dropDown.css({position:"absolute","z-index":"10000",left:"-2000px",top:"-1000px","background-color":"white",border:"1px solid gray",width:o._width,height:o._height});u.document.body.appendChild(a);s=u.document.createElement("button");s.innerHTML="...";s.type="button";h.after(s);u.addClass([s],l.BUTTON);o._btn=s;f(s).on("click."+o.uniqueID,function(n){n.stopPropagation();v._onClick()});return!r.name||(c=u.document.createElement("input"),c.type="hidden",c.name=r.name,u.insertAfter(c,t),o._hidden=c),i.Utils.queue.enque(function(){return o._updateSelection()}),o}return __extends(t,n),t.prototype.templateLoading=function(){},t.prototype.templateLoaded=function(n,t){if(!this.getIsStateDirty()&&!t){var i=this,r=a(n,"lookupGrid");!r||(this._grid=r.grid,!this._grid||(this._grid.syncSetDatasource=!0));this._btnOk=h(n,"btnOk");this._btnCancel=h(n,"btnCancel");f(this._btnOk).click(function(){i._updateSelection();i._hide()});f(this._btnCancel).click(function(){i._hide()})}},t.prototype.templateUnLoading=function(){},t.prototype._createTemplate=function(n){var t=i.createTemplate({parentEl:n,dataContext:this,templEvents:this});return t.templateID=this._templateId,t},t.prototype._onClick=function(){var n=this;n._isOpen||n._open()},t.prototype._onKeyPress=function(n){return(n===13&&this._updateSelection(),n===27||n===9||n===13)?(this._hideAsync(),!0):!1},t.prototype._hideAsync=function(){var n=this;return e.async.delay(function(){n._hide()},100)},t.prototype._updatePosition=function(){this._$dropDown.position({my:"left top",at:"left bottom",of:f(this.el),offset:"0 0"})},t.prototype._onShow=function(){this.objEvents.raise("show",{})},t.prototype._onHide=function(){this.objEvents.raise("hide",{})},t.prototype._open=function(){var n,t,i;if(!this._isOpen){if(n=this,!!this._grid){t=this._$dropDown.get(0);i=n.el;f(u.document).on("mousedown."+this.uniqueID,function(r){u.isContained(r.target,t)||u.isContained(r.target,i)||n._hideAsync()});this._grid.addOnCellDblClicked(function(){n._hide()},this.uniqueID);this._grid.addOnRowSelected(function(t,i){n.onRowSelected(i.row)},this.uniqueID,this);s.selectedControl=n._grid;f(u.document).on("keyup."+this.uniqueID,function(t){s.selectedControl===n._grid&&n._onKeyPress(t.which)&&t.stopPropagation()});this._grid.dataSource=this.dataSource}this._onOpen();this._updatePosition();this._isOpen=!0;this._onShow()}},t.prototype._onOpen=function(){var n=this,t=Object.keys(this._selected),i=n._grid;t.forEach(function(t){var u=n.dataSource.getItemByKey(t),r;!u||(r=i.findRowByItem(u),!r||(r.isSelected=!0))});this._selectedClone=__assign({},this._selected)},t.prototype._hide=function(){this._isOpen&&(this._clear(!1),f(u.document).off("."+this.uniqueID),!this._grid||this._grid.objEvents.offNS(this.uniqueID),this._$dropDown.css({left:"-2000px"}),!this._grid||(this._grid.dataSource=null),this._isOpen=!1,this._onHide())},t.prototype.onRowSelected=function(n){!this._selectedClone||this._selectItem(n.item,n.isSelected)},t.prototype._selectItem=function(n,t){var i=e.core.getValue(n,this._valuePath),f=e.core.getValue(n,this._textPath),r=this._selectedClone,u=e.core.getValue(r,""+i);t?u||e.core.setValue(r,""+i,{v:i,text:f}):!u||delete r[""+i]},t.prototype._clear=function(n){this._selectedClone=null;try{this._grid.rowSelectorCol.checked=!1;this._grid.selectRows(!1)}finally{this._selectedClone={}}n&&this._updateSelection()},t.prototype._updateSelection=function(){this._selected=__assign({},this._selectedClone);this.selectedCount=Object.keys(this._selected).length;this.value="Выбрано: "+this._selectedCount;!this._hidden||(this._hidden.value=Object.keys(this._selected).join(","));this.objEvents.raiseProp("selected");this.objEvents.raiseProp("info")},t.prototype.dispose=function(){this.getIsDisposed()||(this.setDisposing(),this._hide(),f(this.el).off("."+this.uniqueID),!this._grid||(this._grid=null),!this._template||(this._template.dispose(),this._template=null,this._$dropDown=null),f(this._btn).remove(),!this._hidden||(u.removeNode(this._hidden),this._hidden=null),this._selected={},this._selectedCount=0,this._selectedClone={},this._dataSource=null,n.prototype.dispose.call(this))},Object.defineProperty(t.prototype,"templateId",{get:function(){return this._templateId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){if(this.selectedCount==0)return"Ничего не выбрано";var n=[];return e.core.forEach(this._selected,function(t,i){n.push(i.text)}),n.sort().join(",")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this.selectedCount==0?[]:Object.keys(this._selected).map(function(n){return parseInt(n)})},set:function(n){var t,i,r,u;if(!n&&this.selectedCount>0&&this._clear(!0),!!n&&n.length>0&&!!this._dataSource){for(this._selectedClone={},t=0,i=this._dataSource.items;t<i.length;t++)r=i[t],u=parseInt(e.core.getValue(r,this._valuePath)),n.indexOf(u)>-1&&this._selectItem(r,!0);this._updateSelection()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this._template},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.el.value},set:function(n){var t=this.value,i=""+n;n=n?i:"";t!==n&&(this.el.value=n,this.objEvents.raiseProp("value"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedCount",{get:function(){return this._selectedCount},set:function(n){var t=this._selectedCount;t!==n&&(this._selectedCount=n,this.objEvents.raiseProp("selectedCount"))},enumerable:!1,configurable:!0}),t}(r.InputElView);t.DropDownBoxElView=o;t.initModule=v});